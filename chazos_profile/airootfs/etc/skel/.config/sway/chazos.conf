# Chazos - The "Terminal-as-OS" Multiplexer Config
# Mimics Zellij behavior using Sway natively.

# Variables
set $mod Mod4
set $term kitty

# Basic look
default_border pixel 2
default_floating_border none
font pango:monospace 0
titlebar_padding 0
smart_borders on
client.focused #ffffff #282828 #ffffff #ffffff #ffffff

# Start-up: Always open a terminal
exec $term

# --- MODAL SYSTEM ---

# Pane Mode (Super+p)
set $mode_pane Pane: [h/j/k/l] Focus, [H/J/K/L] Move, [n] New, [d] Down, [r] Right, [x] Close, [f] Fullscreen
bindsym $mod+p mode "$mode_pane"

mode "$mode_pane" {
    # Focus (Vim style)
    bindsym h focus left
    bindsym j focus down
    bindsym k focus up
    bindsym l focus right

    # Moving panes (Vim style)
    bindsym Shift+h move left
    bindsym Shift+j move down
    bindsym Shift+k move up
    bindsym Shift+l move right

    # Actions
    bindsym n exec $term
    bindsym d split v; exec $term
    bindsym r split h; exec $term
    bindsym x kill
    bindsym f fullscreen toggle

    # Return to default mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+p mode "default"
}

# Tab Mode (Super+t)
set $mode_tab Tab: [h/l] Switch, [n] New, [x] Close, [1-9] Jump
bindsym $mod+t mode "$mode_tab"

mode "$mode_tab" {
    # Moving between tabs (workspaces)
    bindsym h workspace prev
    bindsym l workspace next
    
    # New Tab (Next available workspace + terminal)
    # This finds the highest workspace number and goes to +1
    bindsym n exec "swaymsg workspace $(swaymsg -t get_workspaces | jq 'map(.num) | max + 1'); exec $term"
    
    # Close Tab (Kill all windows in current workspace)
    # Sway doesn't have a "close workspace" command, so we kill the focused container.
    # If the workspace is empty, it effectively disappears.
    bindsym x kill

    # Quick Jump within mode
    bindsym 1 workspace number 1
    bindsym 2 workspace number 2
    bindsym 3 workspace number 3
    bindsym 4 workspace number 4
    bindsym 5 workspace number 5
    bindsym 6 workspace number 6
    bindsym 7 workspace number 7
    bindsym 8 workspace number 8
    bindsym 9 workspace number 9

    # Return to default mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+t mode "default"
}

# --- TAB MANAGEMENT (Workspaces) ---
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9

# Move focused container to tab
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4

# --- RUN LAUNCHER (For GUI apps) ---
bindsym $mod+r exec "dmenu_path | dmenu | xargs swaymsg exec --"

# Exit Sway (Go back to TTY)
bindsym $mod+Shift+e exec swaynag -t warning -m 'Exit Chazos?' -b 'Yes' 'swaymsg exit'

# Nvidia Compatibility
# These are often needed for Nvidia hardware
exec_always "export WLR_NO_HARDWARE_CURSORS=1"
exec_always "export LIBVA_DRIVER_NAME=nvidia"
exec_always "export __GLX_VENDOR_LIBRARY_NAME=nvidia"

# Include any extra local configs
include /etc/sway/config.d/*
